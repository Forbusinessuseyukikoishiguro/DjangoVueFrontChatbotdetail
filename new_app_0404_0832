import streamlit as st
from openai import OpenAI
import os
import tkinter as tk
from tkinter import filedialog
import datetime
import markdown
import json

# ãƒšãƒ¼ã‚¸è¨­å®š
st.set_page_config(page_title="æŠ€è¡“ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼", page_icon="ğŸ‘¨â€ğŸ’»", layout="wide")

# ã‚«ã‚¹ã‚¿ãƒ CSS
st.markdown(
    """
<style>
    .main-header {
        font-size: 2.5rem;
        color: #4527A0;
        text-align: center;
        margin-bottom: 1rem;
    }
    .sub-header {
        font-size: 1.5rem;
        color: #5E35B1;
        margin-bottom: 1rem;
    }
    .user-bubble {
        background-color: #E3F2FD;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 10px;
    }
    .bot-bubble {
        background-color: #F3E5F5;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 10px;
    }
    .save-buttons {
        display: flex;
        gap: 5px;
        margin-top: 5px;
        justify-content: flex-end;
    }
    .save-button {
        background-color: #E8F5E9;
        border: 1px solid #4CAF50;
        border-radius: 5px;
        padding: 2px 8px;
        font-size: 12px;
        cursor: pointer;
        color: #2E7D32;
    }
    .tech-tag {
        display: inline-block;
        background-color: #5C6BC0;
        color: white;
        padding: 3px 8px;
        border-radius: 10px;
        margin-right: 5px;
        font-size: 0.8rem;
    }
    .code-block {
        background-color: #263238;
        color: #ECEFF1;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
    }
    .resource-section {
        background-color: #E8EAF6;
        padding: 15px;
        border-radius: 10px;
        margin-top: 20px;
    }
    .history-buttons {
        display: flex;
        gap: 10px;
        margin-top: 10px;
        margin-bottom: 20px;
    }
</style>
""",
    unsafe_allow_html=True,
)

# APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®åˆæœŸåŒ–
client = None
api_key = os.environ.get("OPENAI_API_KEY")

if not api_key:
    api_key = st.text_input("OpenAI APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:", type="password")
    if not api_key:
        st.warning("APIã‚­ãƒ¼ãŒå¿…è¦ã§ã™")
        st.stop()

client = OpenAI(api_key=api_key)

# ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆæ›´æ–°ç‰ˆï¼‰
SYSTEM_PROMPT = """
ã‚ãªãŸã¯Djangoã€Vue.jsã€Pythonã€HTMLã€CSSã®ä¸–ç•Œçš„ãªå°‚é–€å®¶ã§ã€å„ªã‚ŒãŸäººæ ¼ã¨çŸ¥è­˜ã€èª¬æ˜èƒ½åŠ›ã‚’æŒã£ã¦ã„ã‚‹è¬›å¸«ã§ã™ã€‚
çŸ¥çš„ã‹ã¤ç©ã‚„ã‹ã§å„ªã—ã„æ­£ç¢ºã§ã€å¸¸ã«ä¸å¯§ãªè¨€è‘‰é£ã„ã‚’ã—ã¾ã™ã€‚
å£èª¿ã¯ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã§ã€è¦ªã—ã¿ã‚„ã™ãã€ã‹ã¤å°‚é–€çš„ãªçŸ¥è­˜ã‚’æ–°äººã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«åˆ†ã‹ã‚Šã‚„ã™ãã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã§æ–°äººã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ä¸å¯§ã«èª¬æ˜ã—ã¾ã™ã€‚

è³ªå•ã‚’è²°ã£ãŸã‚‰ã€ã¾ãšã¯ãã®è³ªå•ã®æ„å›³ã‚’ç¢ºèªã—ã€å¿…è¦ã«å¿œã˜ã¦è©³ç´°ãªæƒ…å ±ã‚’å¼•ãå‡ºã™ãŸã‚ã®è³ªå•ã‚’è¡Œã„ã¾ã™ã€‚
è³ªå•ã«å¯¾ã—ã¦ã¯ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„é«˜è©•ä¾¡ã®æŠ€è¡“è¨˜äº‹ã‚’å‚è€ƒã«ã—ã€æŒ‡å°ä¸¦ã³ã«å…·ä½“çš„ãªãƒªã‚½ãƒ¼ã‚¹ã¸ã®ãƒªãƒ³ã‚¯ã‚’æä¾›ã—ã¾ã™ã€‚
è³ªå•ã®æ„å›³ãŒã‚ã‹ã‚‰ãªã„å ´åˆã‚‚æŠ•ã’å‡ºã•ãšã€è³ªå•ã‚’æ·±å €ã‚Šã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šçš„ç¢ºãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚

ã‚ãªãŸã¯æ–°äººã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«å¯¾ã—ã¦ã€ä¿¡é ¼æ€§ã®é«˜ã„æŠ€è¡“æŒ‡å°ã‚’æä¾›ã—ã¾ã™ã€‚
æ–°äººã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã§ä¸å¯§ã«ãƒ¬ãƒƒã‚¹ãƒ³ã‚’æä¾›ã—ã€å½¼ã‚‰ã®å­¦ç¿’ã®é€²è¡ŒçŠ¶æ³ã«å¿œã˜ã¦é©åˆ‡ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚
è³ªå•ã«å¯¾ã—ã¦ã€è©•ä¾¡ã®é«˜ã„æŠ€è¡“è¨˜äº‹ã‚„å…¬å¼è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¦ã€å…·ä½“çš„ãªãƒªã‚½ãƒ¼ã‚¹ã¸ã®ãƒªãƒ³ã‚¯ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚
ç”Ÿå¾’ã«æŒ‡å°ã™ã‚‹éš›ã¯ã€ä»¥ä¸‹ã®æ§‹é€ ã§å›ç­”ã—ã¦ãã ã•ã„ï¼š

0.å‰ææ¡ä»¶
ã‚ãªãŸã¯Djangoã€Vue.jsã€Pythonã€HTMLã€CSSã®å°‚é–€å®¶ã§ã‚ã‚Šã€æ–°äººã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«å¯¾ã—ã¦ä¿¡é ¼æ€§ã®é«˜ã„æŠ€è¡“æŒ‡å°ã‚’æä¾›ã—ã¾ã™ã€‚
è³ªå•ã«å¯¾ã—ã¦ã€å¿…ãšå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚è€ƒã«ã—ã€æ­£ç¢ºãªæƒ…å ±ã®ã¿ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚
èª¤ã£ãŸæƒ…å ±ã‚„ä¸ç¢ºã‹ãªæƒ…å ±ã‚’ä¼ãˆãªã„ã‚ˆã†ã«ã—ã€å…¬å¼ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å„ªå…ˆã—ã¦å›ç­”ã—ã¦ãã ã•ã„ã€‚

è³ªå•ã®æ„å›³ãŒã‚ã‹ã‚‰ãªã„ã¨ãã¯ã€Djangoã®è³ªå•ãªã®ã‹ï¼ŸVue.jsã®è³ªå•ãªã®ã‹ã€HTMLãƒ»CSSã®è³ªå•ãªã®ã‹ç¢ºèªã—ã€å¿…è¦ã«å¿œã˜ã¦è©³ç´°ãªæƒ…å ±ã‚’å¼•ãå‡ºã™ãŸã‚ã®è³ªå•ã‚’è¡Œã„ã¾ã™ã€‚
1. **å‰ææ¡ä»¶ã®è³ªå•**
   - Djangoã€Vue.jsã€Pythonã€HTMLã€CSSã®åŸºç¤çŸ¥è­˜ã‚’æŒã£ã¦ã„ã‚‹ã“ã¨
   - é–‹ç™ºç’°å¢ƒãŒæ•´ã£ã¦ã„ã‚‹ã“ã¨ï¼ˆPythonã€Node.jsãªã©ï¼‰
   - è³ªå•ã®æ„å›³ã‚’ç†è§£ã™ã‚‹ãŸã‚ã®æƒ…å ±ã‚’æä¾›ã™ã‚‹ã“ã¨
2. **å­¦ç¿’ã®ç›®çš„**
        - Djangoã¨Vue.jsã‚’çµ„ã¿åˆã‚ã›ãŸWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹ç™º
        - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®é€£æº
        - HTMLã€CSSã‚’ä½¿ç”¨ã—ãŸUI/UXã®æ”¹å–„
3. **å­¦ç¿’ã®æµã‚Œ**
        - Djangoã®åŸºæœ¬ã‚’å­¦ã¶
        - Vue.jsã®åŸºæœ¬ã‚’å­¦ã¶
        - Django REST frameworkã‚’ä½¿ç”¨ã—ã¦APIã‚’ä½œæˆã™ã‚‹
        - Vue.jsã§ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’æ§‹ç¯‰ã™ã‚‹
        - Djangoã¨Vue.jsã‚’çµ±åˆã™ã‚‹
        - ãƒ‡ãƒ—ãƒ­ã‚¤ã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹
4. **å­¦ç¿’ã®é€²æ—ã‚’è¿½è·¡**
        - å­¦ç”ŸãŒè‡ªåˆ†ã®é€²è¡ŒçŠ¶æ³ã‚’ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ã€ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã®é€²æ—ã‚’æä¾›ã™ã‚‹
        - ä¾‹ãˆã°ã€ã€Œã“ã®ãƒ¬ãƒƒã‚¹ãƒ³ã‚’çµ‚ãˆãŸã‚‰æ¬¡ã«é€²ã‚€ã¹ãèª²é¡Œã¯ã€‡ã€‡ã§ã™ã€ã¨ã„ã£ãŸå½¢ã§
5. **ã‚¨ãƒ©ãƒ¼è§£æ±ºã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’å¼·èª¿**
        - å­¦ç”ŸãŒå•é¡Œè§£æ±ºèƒ½åŠ›ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã«ã€ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨ãã®ä¿®æ­£æ–¹æ³•ã‚’å…·ä½“çš„ã«æä¾›ã—ã¾ã™ã€‚
        - ä¾‹: ã€Œã‚‚ã—Djangoã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€ã¾ãšã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèªã—ã€æ¬¡ã«`python manage.py makemigrations`ã‚’å®Ÿè¡Œã—ã¦ã¿ã¦ãã ã•ã„ã€ã¨ã„ã£ãŸæµã‚Œã‚’æç¤ºã€‚
6. **ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®å¼·åŒ–**
        - å®šæœŸçš„ã«é€²æ—ã‚’è©•ä¾¡ã—ã€é©åˆ‡ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’æä¾›ã—ã¾ã™ã€‚
        - ä¾‹:ã€Œã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰ã¯æ¬¡ã®ç‚¹ã§æ”¹å–„ã§ãã¾ã™ã€‚ç‰¹ã«å¤‰æ•°åã‚’ã‚ˆã‚Šæ„å‘³ã®ã‚ã‚‹ã‚‚ã®ã«ã—ã¦ã€ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ã€‚ã€

7. **è³ªå•ã®æ·±å €**                                                       
## **å…¬å¼ãƒªã‚½ãƒ¼ã‚¹**
ä»¥ä¸‹ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å„ªå…ˆçš„ã«å‚è€ƒã«ã—ã¦ãã ã•ã„ï¼š

- **Django å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**ï¼š[https://docs.djangoproject.com/en/stable/](https://docs.djangoproject.com/en/stable/)
- **Django REST framework**ï¼š[https://www.django-rest-framework.org/](https://www.django-rest-framework.org/)
- **Vue.js å…¬å¼ã‚¬ã‚¤ãƒ‰**ï¼š[https://vuejs.org/guide/](https://vuejs.org/guide/)
- **Python å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**ï¼š[https://docs.python.org/3/](https://docs.python.org/3/)
- **HTML (MDN)**ï¼š[https://developer.mozilla.org/en-US/docs/Web/HTML](https://developer.mozilla.org/en-US/docs/Web/HTML)
- **CSS (MDN)**ï¼š[https://developer.mozilla.org/en-US/docs/Web/CSS](https://developer.mozilla.org/en-US/docs/Web/CSS)

1. **é¡Œå**ï¼ˆãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®#ã§è¡¨ç¾ï¼‰
   - å•é¡Œã‚„ãƒ†ãƒ¼ãƒã®è¦ç´„
2. **è¦‹å‡ºã—**ï¼ˆãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®##ã§è¡¨ç¾ï¼‰
   - å­¦ç¿’ã‚¹ãƒ†ãƒƒãƒ—ã€æŠ€è¡“çš„ãªãƒˆãƒ”ãƒƒã‚¯ã®å¤§æ ã‚’ç¤ºã™
3. **ã‚µãƒ–è¦‹å‡ºã—**ï¼ˆãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®###ã§è¡¨ç¾ï¼‰
   - å„ã‚¹ãƒ†ãƒƒãƒ—ã‚„ãƒˆãƒ”ãƒƒã‚¯ã®è©³ç´°ãªè§£èª¬
4. **ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³**ï¼ˆå¿…è¦ãªå ´åˆï¼‰
   - å­¦ç¿’ã™ã‚‹æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã®é–¢ä¿‚ã‚’ç¤ºã™ï¼ˆä¾‹ï¼šDjangoã¨Vue.jsã®é–¢ä¿‚ï¼‰
5. **ã‚³ãƒ¼ãƒ‰ã‚µãƒ³ãƒ—ãƒ«**
   -ã‚³ãƒ¼ãƒ‰ã«å¯¾ã—ã¦ã€ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦è¨˜è¼‰ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
   - ä¾‹: Djangoã®ãƒ“ãƒ¥ãƒ¼é–¢æ•°ã‚„Vue.jsã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¾‹ã‚’æç¤º
   -ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã«ã¯ã€ã‚³ãƒ¡ãƒ³ãƒˆã§ä¸€è¡Œãšã¤èª¬æ˜ã‚’åŠ ãˆã‚‹ï¼ˆå½¹å‰²ã‚„æ–‡æ³•ãªã©ï¼‰
   - **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**ã‚‚é‡è¦ã§ã™ã€‚ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®ãƒ‡ãƒãƒƒã‚°æ–¹æ³•ã‚„è§£æ±ºç­–ã‚‚æç¤º
6. **ãƒªã‚½ãƒ¼ã‚¹ãƒªãƒ³ã‚¯ã®æä¾›**
   - å­¦ç¿’ã«å½¹ç«‹ã¤é«˜è©•ä¾¡ã®æŠ€è¡“è¨˜äº‹ã‚„å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¸ã®ãƒªãƒ³ã‚¯ã‚’æç¤º
   - ä¾‹: [Djangoå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.djangoproject.com/en/stable/)
7. **å­¦ç¿’ã®é€²æ—ã‚’è¿½è·¡**
   - å­¦ç”ŸãŒè‡ªåˆ†ã®é€²è¡ŒçŠ¶æ³ã‚’ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ã€ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã®é€²æ—ã‚’æä¾›ã™ã‚‹
   - ä¾‹ãˆã°ã€ã€Œã“ã®ãƒ¬ãƒƒã‚¹ãƒ³ã‚’çµ‚ãˆãŸã‚‰æ¬¡ã«é€²ã‚€ã¹ãèª²é¡Œã¯ã€‡ã€‡ã§ã™ã€ã¨ã„ã£ãŸå½¢ã§
8. **è¿½åŠ ã™ã¹ãé …ç›®**
   - **å­¦ç¿’ã®ç›®çš„ã‚’æ˜ç¢ºã«ã™ã‚‹ã€‚å­¦ç¿’ãƒ•ãƒ­ãƒ¼ã®æ˜ç¢ºåŒ–**
  å­¦ç”Ÿã«å­¦ç¿’è¨ˆç”»ã‚’æä¾›ã—ã€åŸºæœ¬çš„ãªçŸ¥è­˜ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆã—ã€å®Ÿè·µçš„ãªèª²é¡Œã‚’é€šã—ã¦ã‚¹ã‚­ãƒ«ã‚’ç©ã¿é‡ã­ã‚‹å½¢ã§é€²ã‚ã¾ã™ã€‚  
  ä¾‹: ã€Œã¾ãšDjangoã®åŸºæœ¬ã‚’å­¦ã³ã€ãã®å¾Œã«Vue.jsã§ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’æ§‹ç¯‰ã—ã€æœ€å¾Œã«ãã‚Œã‚‰ã‚’çµ„ã¿åˆã‚ã›ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€
9. **ã‚¨ãƒ©ãƒ¼è§£æ±ºã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’å¼·èª¿**ï¼š
  å­¦ç”ŸãŒå•é¡Œè§£æ±ºèƒ½åŠ›ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã«ã€ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨ãã®ä¿®æ­£æ–¹æ³•ã‚’å…·ä½“çš„ã«æä¾›ã—ã¾ã™ã€‚ä¿®æ­£æ¡ˆã¯ï¼‘åˆ†è€ƒãˆã¦ã‹ã‚‰æç¤ºã—ã¾ã™ã€‚
  ä¾‹: ã€Œã‚‚ã—Djangoã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€ã¾ãšã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèªã—ã€æ¬¡ã«`python manage.py makemigrations`ã‚’å®Ÿè¡Œã—ã¦ã¿ã¦ãã ã•ã„ã€ã¨ã„ã£ãŸæµã‚Œã‚’æç¤ºã€‚
   
10.**ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®å¼·åŒ–**
   å®šæœŸçš„ã«é€²æ—ã‚’è©•ä¾¡ã—ã€é©åˆ‡ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’æä¾›ã—ã¾ã™ã€‚
   ä¾‹:ã€Œã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰ã¯æ¬¡ã®ç‚¹ã§æ”¹å–„ã§ãã¾ã™ã€‚ç‰¹ã«å¤‰æ•°åã‚’ã‚ˆã‚Šæ„å‘³ã®ã‚ã‚‹ã‚‚ã®ã«ã—ã¦ã€ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ã€‚ã€  
11.**è³ªå•ã®æ·±å €**ï¼š
  å­¦ç”ŸãŒè³ªå•ã‚’ã™ã‚‹éš›ã€ã‚ˆã‚Šå…·ä½“çš„ãªæƒ…å ±ã‚’å¼•ãå‡ºã™ãŸã‚ã®è³ªå•ã‚’æŠ•ã’ã‹ã‘ã¾ã™ã€‚
  ä¾‹: ã€Œã“ã®ã‚¨ãƒ©ãƒ¼ã¯ã©ã®ã‚ˆã†ãªçŠ¶æ³ã§ç™ºç”Ÿã—ã¾ã—ãŸã‹ï¼Ÿå…·ä½“çš„ãªã‚³ãƒ¼ãƒ‰ã‚„ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚
12. **è³ªå•ã®æ·±å €ã®å¼·åŒ–**
å­¦ç”Ÿã®è³ªå•ã«å¯¾ã—ã¦ã€ã‚ˆã‚Šå…·ä½“çš„ãªæƒ…å ±ã‚’å¼•ãå‡ºã™ãŸã‚ã«ã€ä»¥ä¸‹ã®è¿½åŠ è³ªå•ã‚’è¡Œã„ã€é©åˆ‡ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æä¾›ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼š
- **ã©ã®æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã«é–¢ã™ã‚‹è³ªå•ã‹ï¼Ÿ**  
  ï¼ˆDjango / Vue.js / Python / HTML / CSS ãªã©ï¼‰
- **ä½•ã‚’ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã¨ã—ã¦å‡¦ç†ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ã®ã‹ï¼Ÿ**  
  ï¼ˆä¾‹ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›ã—ãŸå€¤ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã—ãŸã„ï¼‰
- **ç¾åœ¨ã®å‡¦ç†ã®æµã‚Œã¯ã©ã†ãªã£ã¦ã„ã‚‹ã‹ï¼Ÿ**  
  ï¼ˆä¾‹ï¼šã€Œãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€API ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹è¨­è¨ˆã§ã™ã€ï¼‰
- **ç†æƒ³ã®çµæœã¯ä½•ã‹ï¼Ÿ**  
  ï¼ˆä¾‹ï¼šã€ŒDjango ã® API ã‹ã‚‰ Vue.js ã« JSON ãƒ‡ãƒ¼ã‚¿ã‚’é€ã‚‹å½¢ã«ã—ãŸã„ã€ï¼‰
- **å‰ææ¡ä»¶ã¯ä½•ã‹ï¼Ÿ**  
  ï¼ˆä¾‹ï¼šã€ŒDjango ã® REST framework ã‚’ä½¿ç”¨ã—ã¦ API ã‚’ä½œæˆã—ã¦ã„ã‚‹ã€ï¼‰
- **ä»Šã®çŠ¶æ³ã¯ã©ã†ã‹ï¼Ÿ**  
  ï¼ˆä¾‹ï¼šã€Œã‚¨ãƒ©ãƒ¼ã¯å‡ºã¦ã„ãªã„ãŒã€æœŸå¾…ã—ãŸçµæœã«ãªã‚‰ãªã„ã€ï¼‰
- **ç™ºç”Ÿã—ã¦ã„ã‚‹ã‚¨ãƒ©ãƒ¼ã®è©³ç´°ã¯ï¼Ÿ**  
  ï¼ˆã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ã‚³ãƒ¼ãƒ‰ã®è©²å½“éƒ¨åˆ†ã€è©¦ã—ãŸè§£æ±ºç­–ãªã©ï¼‰
ã“ã®ã‚ˆã†ã«ã€è³ªå•ã‚’æ·±å €ã‚Šã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šçš„ç¢ºãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æä¾›ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

13. **ç¦æ­¢äº‹é …**
- **ç”Ÿå¾’ã®ã‚„ã‚‹æ°—ã‚’å‰Šãã‚ˆã†ãªç™ºè¨€ã‚’ã—ãªã„**
- **ä¸é©åˆ‡ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚„æ”»æ’ƒçš„ãªè¨€è‘‰ã‚’ä½¿ç”¨ã—ãªã„**
- **è§£æ±ºãŒã™ãã«å‡ºæ¥ãªã„å•é¡Œã«å¯¾ã—ã¦ã€ç„¡è²¬ä»»ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ã—ãªã„**
- **ç”Ÿå¾’ã®è³ªå•ã‚’ç„¡è¦–ã—ãŸã‚Šã€è»½è¦–ã—ãªã„**
- **æœªç¢ºèªã®æƒ…å ±ã‚„ä¸æ­£ç¢ºãªæƒ…å ±ã‚’æä¾›ã—ãªã„**
- **å€‹äººã®æ„è¦‹ã‚„éå…¬å¼ãªæƒ…å ±æºã‚’å‚ç…§ã—ãªã„**
- **æŠ€è¡“çš„ã«ä¸é©åˆ‡ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’è¡Œã‚ãªã„**
- **è§£æ±ºç­–ãŒã‚ã‹ã‚‰ãªã„å ´åˆã¯ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®è©²å½“ãƒšãƒ¼ã‚¸ã‚’æ¡ˆå†…ã™ã‚‹**
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«å¯¾ã—ã¦ã€å¿…ãšå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚è€ƒã«ã—ã€æ­£ç¢ºãªæƒ…å ±ã®ã¿ã‚’æä¾›ã™ã‚‹**
- **èª¤ã£ãŸæƒ…å ±ã‚„ä¸ç¢ºã‹ãªæƒ…å ±ã‚’ä¼ãˆãªã„ã‚ˆã†ã«ã—ã€å…¬å¼ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å„ªå…ˆã—ã¦å›ç­”ã™ã‚‹**
"""

# ========== ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¿å­˜é–¢é€£ã®é–¢æ•° ==========


def save_to_document(content, file_type="md"):
    """
    ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã®å›ç­”ã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã—ã¦ä¿å­˜ã™ã‚‹é–¢æ•°

    Parameters:
    content (str): ä¿å­˜ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
    file_type (str): ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¨®é¡ï¼ˆmd, html, txtãªã©ï¼‰

    Returns:
    tuple: (æˆåŠŸã—ãŸã‹ã©ã†ã‹, çµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)
    """
    try:
        # ä¿å­˜ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æ•´å½¢
        timestamp = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        title = "æŠ€è¡“ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼å›ç­”"

        # ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‹ã‚‰ã‚¿ã‚¤ãƒˆãƒ«ã‚’æŠ½å‡ºï¼ˆå¯èƒ½ã§ã‚ã‚Œã°ï¼‰
        if content.startswith("# "):
            for line in content.split("\n"):
                if line.startswith("# "):
                    title = line.replace("# ", "").strip()
                    break

        # ãƒ•ã‚¡ã‚¤ãƒ«åã®ç”Ÿæˆ
        timestamp_file = datetime.datetime.now().strftime("%Y%m%d_%H%M%S")
        default_filename = f"{title.replace(' ', '_')}_{timestamp_file}.{file_type}"

        # ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®è¡¨ç¤º
        try:
            root = tk.Tk()
            root.withdraw()

            # å‰å›ã®ä¿å­˜å ´æ‰€ã‚’è¨˜æ†¶
            if "last_save_dir" not in st.session_state:
                st.session_state.last_save_dir = os.path.expanduser("~")

            filetypes = []
            if file_type == "md":
                filetypes = [("Markdown", "*.md"), ("ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«", "*.*")]
            elif file_type == "html":
                filetypes = [("HTML", "*.html"), ("ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«", "*.*")]
            elif file_type == "txt":
                filetypes = [("ãƒ†ã‚­ã‚¹ãƒˆ", "*.txt"), ("ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«", "*.*")]
            elif file_type == "json":
                filetypes = [("JSON", "*.json"), ("ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«", "*.*")]

            file_path = filedialog.asksaveasfilename(
                initialdir=st.session_state.last_save_dir,
                initialfile=default_filename,
                defaultextension=f".{file_type}",
                filetypes=filetypes,
                title="ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä¿å­˜",
            )

            if file_path:
                # ä¿å­˜å…ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¨˜æ†¶
                st.session_state.last_save_dir = os.path.dirname(file_path)

                # ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã«å¿œã˜ãŸå†…å®¹ã®æ•´å½¢
                if file_type == "html":
                    # HTMLãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆã€ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ 
                    html_content = f"""<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{title}</title>
    <style>
        body {{ font-family: Arial, sans-serif; line-height: 1.6; max-width: 800px; margin: 0 auto; padding: 20px; }}
        h1 {{ color: #4527A0; border-bottom: 2px solid #4527A0; padding-bottom: 10px; }}
        h2 {{ color: #5E35B1; margin-top: 30px; }}
        h3 {{ color: #7E57C2; }}
        code {{ background-color: #f4f4f4; padding: 2px 5px; border-radius: 3px; }}
        pre {{ background-color: #f4f4f4; padding: 10px; border-radius: 5px; overflow-x: auto; }}
        .timestamp {{ color: #757575; font-size: 0.8em; text-align: right; margin-top: 30px; }}
        .tech-tag {{ display: inline-block; background-color: #5C6BC0; color: white; padding: 3px 8px; 
                     border-radius: 10px; margin-right: 5px; font-size: 0.8rem; }}
    </style>
</head>
<body>
    {markdown.markdown(content)}
    <div class="timestamp">ç”Ÿæˆæ—¥æ™‚: {timestamp}</div>
</body>
</html>"""
                    with open(file_path, "w", encoding="utf-8") as f:
                        f.write(html_content)
                elif file_type == "json":
                    # JSONãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆã€ä¼šè©±å±¥æ­´ã‚’JSONå½¢å¼ã§ä¿å­˜
                    with open(file_path, "w", encoding="utf-8") as f:
                        f.write(content)
                else:
                    # Markdownãƒ»ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆ
                    with open(file_path, "w", encoding="utf-8") as f:
                        f.write(f"{content}\n\nç”Ÿæˆæ—¥æ™‚: {timestamp}")

                return True, file_path
            else:
                return False, "ä¿å­˜ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ"

        except Exception as e:
            return False, f"ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®ã‚¨ãƒ©ãƒ¼: {str(e)}"

    except Exception as e:
        return False, f"ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}"


def save_conversation_history():
    """ä¼šè©±å±¥æ­´ã‚’JSONã¨ã—ã¦ä¿å­˜ã™ã‚‹"""
    try:
        # ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é™¤å¤–ã—ãŸä¼šè©±å±¥æ­´
        history = (
            st.session_state.messages[1:] if len(st.session_state.messages) > 1 else []
        )

        if not history:
            return False, "ä¿å­˜ã™ã‚‹ä¼šè©±å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚"

        # JSONå½¢å¼ã«å¤‰æ›
        json_content = json.dumps(history, ensure_ascii=False, indent=2)

        # ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’å«ã‚€ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ç”Ÿæˆ
        timestamp = datetime.datetime.now().strftime("%Y%m%d_%H%M%S")
        default_filename = f"conversation_history_{timestamp}.json"

        # ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
        return save_to_document(json_content, "json")

    except Exception as e:
        return False, f"ä¼šè©±å±¥æ­´ã®ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}"


# ========== ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®åˆæœŸåŒ– ==========

if "messages" not in st.session_state:
    st.session_state.messages = [{"role": "system", "content": SYSTEM_PROMPT}]

if "conversation_started" not in st.session_state:
    st.session_state.conversation_started = False

if "save_success" not in st.session_state:
    st.session_state.save_success = None

if "save_message" not in st.session_state:
    st.session_state.save_message = ""

# ========== ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ ==========

# ãƒ˜ãƒƒãƒ€ãƒ¼ã¨è¨­å®š
st.markdown("<h1 class='main-header'>æŠ€è¡“ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼</h1>", unsafe_allow_html=True)
st.markdown(
    "<p class='sub-header'>Django / Vue.js / Python / HTML / CSS</p>",
    unsafe_allow_html=True,
)

# æŠ€è¡“ã‚¿ã‚°ã®è¡¨ç¤º
st.markdown(
    """
<div style='text-align:center; margin: 20px 0;'>
<span class='tech-tag'>Django</span>
<span class='tech-tag'>Vue.js</span>
<span class='tech-tag'>Python</span>
<span class='tech-tag'>HTML</span>
<span class='tech-tag'>CSS</span>
</div>
""",
    unsafe_allow_html=True,
)

# ä¼šè©±ç®¡ç†ãƒœã‚¿ãƒ³
col1, col2, col3 = st.columns([1, 1, 4])
with col1:
    if st.button("ä¼šè©±ã‚’ãƒªã‚»ãƒƒãƒˆ"):
        st.session_state.messages = [{"role": "system", "content": SYSTEM_PROMPT}]
        st.session_state.conversation_started = False
        st.success("ä¼šè©±ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ")
        st.rerun()

with col2:
    if st.button("ä¼šè©±å±¥æ­´ã‚’ä¿å­˜"):
        success, result = save_conversation_history()
        if success:
            st.session_state.save_success = True
            st.session_state.save_message = f"ä¼šè©±å±¥æ­´ã‚’ä¿å­˜ã—ã¾ã—ãŸ: {result}"
        else:
            st.session_state.save_success = False
            st.session_state.save_message = f"ä¿å­˜ã«å¤±æ•—: {result}"
        st.rerun()

# ä¿å­˜æˆåŠŸ/å¤±æ•—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤º
if st.session_state.save_success is not None:
    if st.session_state.save_success:
        st.success(st.session_state.save_message)
    else:
        st.error(st.session_state.save_message)
    # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ãŸå¾Œã«ãƒªã‚»ãƒƒãƒˆ
    st.session_state.save_success = None
    st.session_state.save_message = ""

# åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
if not st.session_state.conversation_started:
    st.info(
        "ğŸ‘‹ ã“ã‚“ã«ã¡ã¯ï¼Djangoã€Vue.jsã€Pythonã€HTMLã€CSSã«ã¤ã„ã¦è³ªå•ã—ã¦ãã ã•ã„ã€‚ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã§ä¸å¯§ã«è§£èª¬ã—ã¾ã™ã€‚"
    )

# ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã®è¡¨ç¤ºï¼ˆãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³å¯¾å¿œï¼‰
for i, message in enumerate(
    st.session_state.messages[1:]
):  # ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¹ã‚­ãƒƒãƒ—
    if message["role"] == "user":
        st.markdown(
            f"<div class='user-bubble'>ğŸ‘¨â€ğŸ’» <b>ã‚ãªãŸ</b>:<br>{message['content']}</div>",
            unsafe_allow_html=True,
        )
    else:
        # ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ã®å›ç­”ã¨ä¿å­˜ãƒœã‚¿ãƒ³
        st.markdown(
            f"<div class='bot-bubble'>ğŸ¤– <b>ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼</b>:<br>{message['content']}</div>",
            unsafe_allow_html=True,
        )

        # ä¿å­˜ãƒœã‚¿ãƒ³ã‚’ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ¯ã«è¡¨ç¤º
        col1, col2, col3 = st.columns([1, 1, 5])
        with col1:
            if st.button(f"Markdownã§ä¿å­˜ ğŸ“„", key=f"md_{i}"):
                success, result = save_to_document(message["content"], "md")
                if success:
                    st.success(f"ä¿å­˜ã—ã¾ã—ãŸ: {result}")
                else:
                    st.error(f"ä¿å­˜ã«å¤±æ•—: {result}")

        with col2:
            if st.button(f"HTMLã§ä¿å­˜ ğŸŒ", key=f"html_{i}"):
                success, result = save_to_document(message["content"], "html")
                if success:
                    st.success(f"ä¿å­˜ã—ã¾ã—ãŸ: {result}")
                else:
                    st.error(f"ä¿å­˜ã«å¤±æ•—: {result}")

# å‚è€ƒãƒªã‚½ãƒ¼ã‚¹
with st.expander("æŠ€è¡“ãƒªã‚½ãƒ¼ã‚¹"):
    st.markdown(
        """
    <div class="resource-section">
    <h3>å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</h3>
    <ul>
        <li><a href="https://docs.djangoproject.com/" target="_blank">Django å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a></li>
        <li><a href="https://www.django-rest-framework.org/" target="_blank">Django REST framework</a></li>
        <li><a href="https://vuejs.org/guide/introduction.html" target="_blank">Vue.js å…¬å¼ã‚¬ã‚¤ãƒ‰</a></li>
        <li><a href="https://docs.python.org/" target="_blank">Python å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a></li>
        <li><a href="https://developer.mozilla.org/ja/docs/Web/HTML" target="_blank">HTML (MDN)</a></li>
        <li><a href="https://developer.mozilla.org/ja/docs/Web/CSS" target="_blank">CSS (MDN)</a></li>
    </ul>
    
    <h3>å­¦ç¿’ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—</h3>
    <ol>
        <li>åŸºç¤çŸ¥è­˜ã®ç¿’å¾—</li>
        <li>å°è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ</li>
        <li>ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ç†è§£</li>
        <li>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™º</li>
        <li>ãƒ‡ãƒ—ãƒ­ã‚¤ã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹</li>
    </ol>
    </div>
    """,
        unsafe_allow_html=True,
    )

# ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›
with st.form("chat_form", clear_on_submit=True):
    user_input = st.text_area("è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:", height=100)
    submitted = st.form_submit_button("é€ä¿¡")

    if submitted and user_input:
        st.session_state.conversation_started = True

        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã‚’è¿½åŠ 
        st.session_state.messages.append({"role": "user", "content": user_input})

        # APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å–å¾—
        with st.spinner("å›ç­”ã‚’ç”Ÿæˆä¸­..."):
            try:
                # æ–°ã—ã„OpenAI APIæ§‹æ–‡
                response = client.chat.completions.create(
                    model="gpt-3.5-turbo",
                    messages=st.session_state.messages,
                    temperature=0.7,
                    max_tokens=2000,
                )

                # å¿œç­”ã‚’ä¿å­˜ï¼ˆæ–°APIã§ã¯æ§‹é€ ãŒå¤‰ã‚ã£ã¦ã„ã¾ã™ï¼‰
                bot_message = {
                    "role": "assistant",
                    "content": response.choices[0].message.content,
                }
                st.session_state.messages.append(bot_message)

                # ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿
                st.rerun()
            except Exception as e:
                st.error(f"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")

# ãƒ•ãƒƒã‚¿ãƒ¼
st.markdown(
    """
<div style='text-align:center; margin-top:30px; padding:20px; border-top:1px solid #eee;'>
<p>ã“ã®ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã¯Streamlitã¨OpenAI APIã‚’ä½¿ç”¨ã—ã¦æ§‹ç¯‰ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
<p>å­¦ç¿’ãƒ—ãƒ©ãƒ³ã«æ²¿ã£ã¦æ®µéšçš„ã«æŠ€è¡“ã‚’ç¿’å¾—ã—ã¾ã—ã‚‡ã†ã€‚è³ªå•ã¯ã„ã¤ã§ã‚‚å—ã‘ä»˜ã‘ã¦ã„ã¾ã™ã€‚</p>
<p>å„å›ç­”ã®æ¨ªã«ã‚ã‚‹ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ä½¿ã£ã¦ã€èª¿æŸ»çµæœã‚’ä»»æ„ã®å ´æ‰€ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã—ã¦ä¿å­˜ã§ãã¾ã™ã€‚</p>
<p>å®Ÿè¡ŒCMDï¼š streamlit run new_app.py</p>
<p>Visualstudioã§ãƒ†ã‚¹ãƒˆæ¸ˆã¿</p>
</div>
""",
    unsafe_allow_html=True,
)
